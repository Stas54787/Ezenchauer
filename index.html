<!DOCTYPE html>
<html lang="ru">
	<head>
		<!-- Firebase SDK v9 -->
		<script type="module">
			import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js'
			import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js'

			const firebaseConfig = {
				apiKey: 'AIzaSyCAMq5JS7Yo5XyVYGuUqMjqRh9fKBLyF9o',
				authDomain: 'ezenhauer-bb5d0.firebaseapp.com',
				projectId: 'ezenhauer-bb5d0',
				storageBucket: 'ezenhauer-bb5d0.appspot.com',
				messagingSenderId: '671270341195',
				appId: '1:671270341195:web:dd39ec407c8fe4a8b8dbce',
				measurementId: 'G-FS5XM58TZP',
			}

			console.log('üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase...')

			try {
				window.firebaseApp = initializeApp(firebaseConfig)
				window.db = getFirestore(window.firebaseApp)
				window.firebaseReady = true
				console.log('‚úÖ Firebase –≥–æ—Ç–æ–≤!')

				setTimeout(() => {
					const statusDiv = document.createElement('div')
					statusDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    background: #10b981;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                `
					statusDiv.textContent = 'üî• –û–±–ª–∞–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ!'
					document.body.appendChild(statusDiv)
					setTimeout(() => statusDiv.remove(), 3000)
				}, 1000)
			} catch (error) {
				console.error('‚ùå –û—à–∏–±–∫–∞ Firebase:', error)
				window.firebaseReady = false
				setTimeout(() => {
					const errorDiv = document.createElement('div')
					errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    background: #ef4444;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                `
					errorDiv.textContent = '‚ùå –û–±–ª–∞–∫–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'
					document.body.appendChild(errorDiv)
					setTimeout(() => errorDiv.remove(), 5000)
				}, 1000)
			}
		</script>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á - –ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞</title>
		<link rel="icon" href="data:," />
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
				color: #130909;
				margin: 0;
				overflow: hidden;
			}

			.header {
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				height: 60px;
				background: rgba(255, 255, 255, 0.8);
				backdrop-filter: blur(20px);
				border-bottom: 1px solid rgba(255, 255, 255, 0.2);
				display: flex;
				align-items: center;
				padding: 0 20px;
				z-index: 1001;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
			}

			.app-title {
				font-size: 20px;
				font-weight: 700;
				color: #475569;
			}

			.container {
				display: flex;
				height: 100vh;
				padding-top: 60px;
			}

			.sidebar-trigger {
				position: fixed;
				left: 0;
				top: 60px;
				width: 20px;
				height: calc(100vh - 60px);
				z-index: 1002;
				background: rgba(99, 102, 241, 0.1);
				cursor: pointer;
				transition: all 0.3s ease;
				border-right: 2px solid rgba(99, 102, 241, 0.2);
			}

			.sidebar-trigger:hover {
				width: 30px;
				background: rgba(99, 102, 241, 0.2);
			}

			.sidebar {
				position: fixed;
				left: -350px;
				top: 60px;
				width: 320px;
				height: calc(100vh - 60px);
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(20px);
				border-right: 1px solid rgba(255, 255, 255, 0.2);
				box-shadow: 2px 0 30px rgba(0, 0, 0, 0.1);
				padding: 20px;
				overflow-y: auto;
				transition: left 0.3s ease;
				z-index: 1001;
			}

			.sidebar.show {
				left: 0;
			}

			.sidebar-overlay {
				position: fixed;
				top: 60px;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(15, 23, 42, 0.2);
				backdrop-filter: blur(3px);
				opacity: 0;
				visibility: hidden;
				transition: all 0.3s ease;
				z-index: 1000;
			}

			.sidebar-overlay.show {
				opacity: 1;
				visibility: visible;
			}

			.sidebar h2 {
				margin-bottom: 20px;
				color: #130909;
				font-size: 20px;
				font-weight: 700;
				position: relative;
			}

			.sidebar h2::after {
				content: '';
				position: absolute;
				bottom: -8px;
				left: 0;
				width: 50px;
				height: 3px;
				background: linear-gradient(135deg, #fc403a 0%, #e73c7e 100%);
				border-radius: 2px;
			}

			.task-input {
				width: 100%;
				padding: 14px 16px;
				border: 1px solid rgba(148, 163, 184, 0.3);
				background: rgba(255, 255, 255, 0.8);
				backdrop-filter: blur(10px);
				border-radius: 12px;
				margin-bottom: 12px;
				font-size: 14px;
				outline: none;
				transition: all 0.3s ease;
				color: #334155;
				font-weight: 500;
			}

			.task-input:focus {
				border-color: rgba(99, 102, 241, 0.5);
				background: rgba(255, 255, 255, 0.95);
				box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
				transform: translateY(-1px);
			}

			.task-item {
				background: rgba(255, 255, 255, 0.8);
				backdrop-filter: blur(10px);
				padding: 14px 16px;
				border-radius: 12px;
				margin-bottom: 10px;
				cursor: move;
				border: 1px solid rgba(148, 163, 184, 0.2);
				transition: all 0.3s ease;
				position: relative;
				color: #334155;
				font-weight: 500;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
			}

			.task-item:hover {
				background: rgba(255, 255, 255, 0.95);
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
				border-color: rgba(99, 102, 241, 0.3);
			}

			.task-item.dragging {
				opacity: 0.7;
				transform: rotate(2deg) scale(1.02);
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
			}

			.add-materials-btn {
				width: 100%;
				padding: 14px;
				background: rgba(99, 102, 241, 0.1);
				color: #6366f1;
				border: 1px solid rgba(99, 102, 241, 0.2);
				border-radius: 12px;
				cursor: pointer;
				font-size: 14px;
				font-weight: 600;
				margin-top: 20px;
				transition: all 0.3s ease;
				backdrop-filter: blur(10px);
			}

			.add-materials-btn:hover {
				background: rgba(99, 102, 241, 0.15);
				transform: translateY(-1px);
				box-shadow: 0 4px 20px rgba(99, 102, 241, 0.2);
			}

			.matrix {
				flex: 1;
				display: grid;
				grid-template-columns: 1fr 1fr;
				grid-template-rows: 1fr 1fr;
				gap: 20px;
				padding: 20px;
				margin-left: 0;
				transition: margin-left 0.3s ease;
			}

			.matrix.sidebar-open {
				margin-left: 320px;
			}

			.matrix-quadrant {
				background: rgba(255, 255, 255, 0.8);
				backdrop-filter: blur(20px);
				border-radius: 16px;
				border: 1px solid rgba(255, 255, 255, 0.3);
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
				padding: 24px;
				position: relative;
				display: flex;
				flex-direction: column;
				height: calc((100vh - 100px) / 2 - 10px);
				transition: all 0.3s ease;
			}

			.matrix-quadrant:hover {
				box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
				transform: translateY(-1px);
			}

			.quadrant-header {
				margin-bottom: 20px;
				text-align: center;
				flex-shrink: 0;
			}

			.quadrant-title {
				font-size: 20px;
				font-weight: 700;
				margin-bottom: 8px;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			.quadrant-subtitle {
				font-size: 14px;
				color: rgba(19, 9, 9, 0.7);
				margin-bottom: 12px;
				font-weight: 600;
			}

			.quadrant-examples {
				font-size: 12px;
				color: rgba(19, 9, 9, 0.6);
				font-style: italic;
				line-height: 1.5;
				background: rgba(252, 64, 58, 0.05);
				padding: 12px;
				border-radius: 8px;
			}

			.urgent-important {
				border-left: 4px solid rgba(239, 68, 68, 0.6);
				background: linear-gradient(
					135deg,
					rgba(255, 255, 255, 0.9) 0%,
					rgba(239, 68, 68, 0.02) 100%
				);
			}

			.urgent-important .quadrant-title {
				color: rgba(239, 68, 68, 0.8);
			}

			.urgent-important .task-in-matrix {
				background: rgba(239, 68, 68, 0.1);
				backdrop-filter: blur(10px);
				color: #130909;
				border-left-color: rgba(239, 68, 68, 0.3);
				border: 1px solid rgba(239, 68, 68, 0.15);
			}

			.urgent-important .task-in-matrix:hover {
				background: rgba(239, 68, 68, 0.15);
				box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15);
				transform: translateY(-2px);
			}

			.urgent-important .delete-btn {
				background: rgba(255, 255, 255, 0.9);
				color: #ef4444;
				backdrop-filter: blur(10px);
			}

			.not-urgent-important {
				border-left: 4px solid rgba(22, 163, 74, 0.6);
				background: linear-gradient(
					135deg,
					rgba(255, 255, 255, 0.9) 0%,
					rgba(22, 163, 74, 0.02) 100%
				);
			}

			.not-urgent-important .quadrant-title {
				color: rgba(22, 163, 74, 0.8);
			}

			.not-urgent-important .task-in-matrix {
				background: rgba(22, 163, 74, 0.1);
				backdrop-filter: blur(10px);
				color: #130909;
				border-left-color: rgba(22, 163, 74, 0.3);
				border: 1px solid rgba(22, 163, 74, 0.15);
			}

			.not-urgent-important .task-in-matrix:hover {
				background: rgba(22, 163, 74, 0.15);
				box-shadow: 0 8px 25px rgba(22, 163, 74, 0.15);
				transform: translateY(-2px);
			}

			.not-urgent-important .delete-btn {
				background: rgba(255, 255, 255, 0.9);
				color: #16a34a;
				backdrop-filter: blur(10px);
			}

			.urgent-not-important {
				border-left: 4px solid rgba(14, 165, 233, 0.6);
				background: linear-gradient(
					135deg,
					rgba(255, 255, 255, 0.9) 0%,
					rgba(14, 165, 233, 0.02) 100%
				);
			}

			.urgent-not-important .quadrant-title {
				color: rgba(14, 165, 233, 0.8);
			}

			.urgent-not-important .task-in-matrix {
				background: rgba(14, 165, 233, 0.1);
				backdrop-filter: blur(10px);
				color: #130909;
				border-left-color: rgba(14, 165, 233, 0.3);
				border: 1px solid rgba(14, 165, 233, 0.15);
			}

			.urgent-not-important .task-in-matrix:hover {
				background: rgba(14, 165, 233, 0.15);
				box-shadow: 0 8px 25px rgba(14, 165, 233, 0.15);
				transform: translateY(-2px);
			}

			.urgent-not-important .delete-btn {
				background: rgba(255, 255, 255, 0.9);
				color: #0ea5e9;
				backdrop-filter: blur(10px);
			}

			.not-urgent-not-important {
				border-left: 4px solid rgba(107, 114, 128, 0.6);
				background: linear-gradient(
					135deg,
					rgba(255, 255, 255, 0.9) 0%,
					rgba(107, 114, 128, 0.02) 100%
				);
			}

			.not-urgent-not-important .quadrant-title {
				color: rgba(107, 114, 128, 0.8);
			}

			.not-urgent-not-important .task-in-matrix {
				background: rgba(107, 114, 128, 0.1);
				backdrop-filter: blur(10px);
				color: #374151;
				border-left-color: rgba(107, 114, 128, 0.3);
				border: 1px solid rgba(107, 114, 128, 0.15);
			}

			.not-urgent-not-important .task-in-matrix:hover {
				background: rgba(107, 114, 128, 0.15);
				box-shadow: 0 8px 25px rgba(107, 114, 128, 0.15);
				transform: translateY(-2px);
			}

			.not-urgent-not-important .delete-btn {
				background: rgba(255, 255, 255, 0.9);
				color: #6b7280;
				backdrop-filter: blur(10px);
			}

			.drop-zone {
				flex: 1;
				border: 2px dashed transparent;
				border-radius: 8px;
				padding: 10px;
				transition: all 0.3s;
				position: relative;
				overflow-y: auto;
				max-height: 100%;
			}

			.drop-zone::-webkit-scrollbar,
			.tasks-list::-webkit-scrollbar {
				width: 8px;
			}

			.drop-zone::-webkit-scrollbar-track,
			.tasks-list::-webkit-scrollbar-track {
				background: rgba(252, 64, 58, 0.05);
				border-radius: 4px;
			}

			.drop-zone::-webkit-scrollbar-thumb,
			.tasks-list::-webkit-scrollbar-thumb {
				background: rgba(252, 64, 58, 0.3);
				border-radius: 4px;
				transition: all 0.3s ease;
			}

			.drop-zone::-webkit-scrollbar-thumb:hover,
			.tasks-list::-webkit-scrollbar-thumb:hover {
				background: rgba(252, 64, 58, 0.5);
			}

			.task-in-matrix {
				padding: 14px 16px;
				border-radius: 12px;
				margin-bottom: 10px;
				position: relative;
				cursor: move;
				transition: all 0.3s ease;
				min-height: 50px;
				word-wrap: break-word;
				font-weight: 500;
				box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
			}

			.task-in-matrix.dragging {
				opacity: 0.7;
				transform: rotate(1deg) scale(1.02);
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
			}

			.task-in-matrix.drag-over-task {
				transform: scale(1.01);
				box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
			}

			.delete-btn {
				position: absolute;
				top: 8px;
				right: 8px;
				border: none;
				border-radius: 50%;
				width: 24px;
				height: 24px;
				cursor: pointer;
				font-size: 14px;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.3s ease;
				font-weight: bold;
			}

			.delete-btn:hover {
				transform: scale(1.05);
			}

			.materials-attached {
				box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2) !important;
			}

			.materials-list {
				margin-top: 12px;
				padding-top: 12px;
				border-top: 1px solid rgba(252, 64, 58, 0.2);
			}

			.material-item {
				font-size: 12px;
				color: #130909;
				margin-bottom: 6px;
				padding: 8px 10px;
				background: #ffffff;
				border-radius: 8px;
				border: 1px solid rgba(252, 64, 58, 0.1);
				transition: all 0.3s ease;
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
				box-shadow: 0 2px 8px rgba(252, 64, 58, 0.05);
			}

			.material-item:hover {
				background: #ffffff;
				transform: translateY(-1px);
				box-shadow: 0 4px 15px rgba(252, 64, 58, 0.15);
				border-color: rgba(252, 64, 58, 0.3);
			}

			.material-item.dragging {
				opacity: 0.6;
				transform: rotate(2deg) scale(1.05);
				box-shadow: 0 8px 20px rgba(252, 64, 58, 0.3);
			}

			.material-content {
				flex: 1;
				display: flex;
				align-items: center;
			}

			.material-icon {
				margin-right: 8px;
				cursor: move;
				padding: 4px;
				border-radius: 4px;
				transition: all 0.3s ease;
				font-size: 14px;
			}

			.material-icon:hover {
				background: rgba(252, 64, 58, 0.1);
				transform: scale(1.1);
			}

			.material-link {
				color: #fc403a;
				text-decoration: none;
				font-weight: 600;
				cursor: pointer;
				pointer-events: auto;
				transition: all 0.3s ease;
			}

			.material-link:hover {
				text-decoration: underline;
				color: #e73c7e;
			}

			.file-download {
				color: #130909;
				font-weight: 500;
			}

			.file-download:hover {
				color: #fc403a;
			}

			.material-actions {
				display: flex;
				gap: 4px;
			}

			.material-btn {
				background: rgba(252, 64, 58, 0.1);
				color: #fc403a;
				border: none;
				border-radius: 6px;
				padding: 4px 8px;
				cursor: pointer;
				font-size: 11px;
				font-weight: 600;
				transition: all 0.3s ease;
			}

			.material-btn:hover {
				background: #fc403a;
				color: #ffffff;
				transform: scale(1.05);
			}

			.material-btn.remove {
				background: rgba(252, 64, 58, 0.1);
				color: #fc403a;
			}

			.material-btn.remove:hover {
				background: #fc403a;
				color: #ffffff;
			}

			.tasks-list {
				max-height: 250px;
				overflow-y: auto;
				margin-bottom: 20px;
				padding-right: 5px;
			}

			.modal {
				display: none;
				position: fixed;
				z-index: 2000;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				background: rgba(19, 9, 9, 0.6);
				backdrop-filter: blur(5px);
			}

			.modal-content {
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(20px);
				margin: 8% auto;
				padding: 32px;
				border-radius: 16px;
				width: 480px;
				max-width: 85%;
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
				border: 1px solid rgba(255, 255, 255, 0.3);
			}

			.modal-header {
				margin-bottom: 24px;
				text-align: center;
			}

			.modal-header h3 {
				color: #130909;
				font-size: 24px;
				font-weight: 700;
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-group label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: #130909;
				font-size: 14px;
			}

			.form-group input,
			.form-group textarea {
				width: 100%;
				padding: 14px 16px;
				border: 2px solid rgba(252, 64, 58, 0.2);
				border-radius: 12px;
				font-size: 14px;
				outline: none;
				transition: all 0.3s ease;
				background: #ffffff;
				color: #130909;
			}

			.form-group input:focus,
			.form-group textarea:focus {
				border-color: #fc403a;
				box-shadow: 0 0 0 3px rgba(252, 64, 58, 0.1);
			}

			.file-upload {
				border: 2px dashed rgba(252, 64, 58, 0.3);
				border-radius: 12px;
				padding: 24px;
				text-align: center;
				cursor: pointer;
				transition: all 0.3s ease;
				background: rgba(252, 64, 58, 0.02);
			}

			.file-upload:hover {
				border-color: #fc403a;
				background: rgba(252, 64, 58, 0.05);
				transform: translateY(-2px);
			}

			.file-upload input[type='file'] {
				display: none;
			}

			.modal-buttons {
				display: flex;
				justify-content: flex-end;
				gap: 12px;
				margin-top: 24px;
			}

			.btn {
				padding: 12px 24px;
				border: none;
				border-radius: 12px;
				cursor: pointer;
				font-size: 14px;
				font-weight: 600;
				transition: all 0.3s ease;
			}

			.btn-primary {
				background: linear-gradient(135deg, #fc403a 0%, #e73c7e 100%);
				color: #ffffff;
				box-shadow: 0 4px 15px rgba(252, 64, 58, 0.3);
			}

			.btn-primary:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(252, 64, 58, 0.4);
			}

			.btn-secondary {
				background: rgba(19, 9, 9, 0.1);
				color: #130909;
				border: 2px solid rgba(19, 9, 9, 0.2);
			}

			.btn-secondary:hover {
				background: rgba(19, 9, 9, 0.15);
				transform: translateY(-1px);
			}

			.attached-files {
				margin-top: 16px;
			}

			.file-item {
				display: flex;
				align-items: center;
				padding: 10px 12px;
				background: rgba(252, 64, 58, 0.05);
				border-radius: 8px;
				margin-bottom: 8px;
				border: 1px solid rgba(252, 64, 58, 0.1);
			}

			.file-item span {
				flex: 1;
				font-size: 13px;
				color: #130909;
				font-weight: 500;
			}

			.file-item button {
				background: #fc403a;
				color: #ffffff;
				border: none;
				border-radius: 6px;
				padding: 6px 10px;
				cursor: pointer;
				font-size: 12px;
				font-weight: 600;
				transition: all 0.3s ease;
			}

			.file-item button:hover {
				background: #e73c7e;
				transform: scale(1.05);
			}

			.materials-preview {
				margin-top: 20px;
				padding: 20px;
				background: rgba(252, 64, 58, 0.02);
				border-radius: 12px;
				border: 1px solid rgba(252, 64, 58, 0.1);
				display: none;
			}

			.materials-preview.has-materials {
				display: block;
			}

			.materials-preview h4 {
				margin: 0 0 12px 0;
				color: #130909;
				font-size: 16px;
				font-weight: 700;
			}

			.materials-preview .help-text {
				font-size: 12px;
				color: rgba(19, 9, 9, 0.6);
				margin-bottom: 16px;
				font-style: italic;
				padding: 8px 12px;
				background: rgba(252, 64, 58, 0.05);
				border-radius: 6px;
			}

			.preview-item {
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 12px;
				margin-bottom: 8px;
				background: #ffffff;
				border-radius: 10px;
				border: 1px solid rgba(252, 64, 58, 0.1);
				font-size: 13px;
				color: #130909;
				position: relative;
				cursor: move;
				transition: all 0.3s ease;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
			}

			.preview-item:hover {
				background: rgba(252, 64, 58, 0.05);
				transform: translateY(-2px);
				box-shadow: 0 4px 15px rgba(252, 64, 58, 0.15);
			}

			.preview-item.dragging {
				opacity: 0.6;
				transform: rotate(2deg) scale(1.05);
				box-shadow: 0 8px 20px rgba(252, 64, 58, 0.3);
			}

			.preview-content {
				flex: 1;
				display: flex;
				align-items: center;
			}

			.preview-icon {
				margin-right: 8px;
				font-size: 16px;
			}

			.preview-text {
				flex: 1;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.preview-link {
				color: #fc403a;
				text-decoration: none;
				font-weight: 600;
				transition: all 0.3s ease;
			}

			.preview-link:hover {
				text-decoration: underline;
				color: #e73c7e;
			}

			.preview-remove {
				background: rgba(252, 64, 58, 0.1);
				color: #fc403a;
				border: none;
				border-radius: 6px;
				padding: 4px 8px;
				cursor: pointer;
				font-size: 12px;
				font-weight: 600;
				transition: all 0.3s ease;
				position: absolute;
				top: 8px;
				right: 8px;
			}

			.preview-remove:hover {
				background: #fc403a;
				color: #ffffff;
			}
		</style>
	</head>
	<body>
		<div class="header">
			<div class="app-title">–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á - –ú–∞—Ç—Ä–∏—Ü–∞ –≠–π–∑–µ–Ω—Ö–∞—É—ç—Ä–∞</div>
		</div>

		<div class="sidebar-trigger" onclick="toggleSidebar()"></div>
		<div class="sidebar-overlay" onclick="closeSidebar()"></div>

		<div class="container">
			<div class="sidebar">
				<h2>–ö–æ–ø–∏–ª–∫–∞ –∑–∞–¥–∞—á</h2>
				<div id="taskInputContainer">
					<input
						type="text"
						id="mainTaskInput"
						class="task-input"
						placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É –∏ –Ω–∞–∂–º–∏—Ç–µ Enter"
						autocomplete="off"
						autocorrect="off"
						autocapitalize="off"
						spellcheck="false"
					/>
				</div>
				<div id="tasksList" class="tasks-list"></div>
				<div style="margin-bottom: 20px">
					<button
						class="btn btn-primary"
						style="width: 100%; margin-bottom: 10px"
						onclick="saveTasksToCloud()"
					>
						‚òÅÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ
					</button>
					<button
						class="btn btn-secondary"
						style="width: 100%; margin-bottom: 10px"
						onclick="loadTasksFromCloud()"
					>
						üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞
					</button>
					<button
						class="btn btn-secondary"
						style="width: 100%; margin-bottom: 10px; font-size: 12px"
						onclick="checkCloudStatus()"
					>
						üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
					</button>
				</div>
				<button class="add-materials-btn" onclick="openMaterialsModal()">
					–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã
				</button>
				<div id="materialsPreview" class="materials-preview"></div>
			</div>

			<div class="matrix">
				<div class="matrix-quadrant urgent-important">
					<div class="quadrant-header">
						<div class="quadrant-title">–°—Ä–æ—á–Ω–æ–µ</div>
						<div class="quadrant-subtitle">–í–ê–ñ–ù–û</div>
						<div class="quadrant-examples">
							–î–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ<br /><br />
							‚Ä¢ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö<br />
							‚Ä¢ –°—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞<br />
							‚Ä¢ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–¥–ª–∞–π–Ω—ã —Å–µ–≥–æ–¥–Ω—è<br />
							‚Ä¢ –°–¥–∞—Ç—å –æ—Ç—á–µ—Ç
						</div>
					</div>
					<div class="drop-zone" data-quadrant="urgent-important"></div>
				</div>
				<div class="matrix-quadrant not-urgent-important">
					<div class="quadrant-header">
						<div class="quadrant-title">–ù–µ —Å—Ä–æ—á–Ω–æ–µ</div>
						<div class="quadrant-subtitle">–í–ê–ñ–ù–û</div>
						<div class="quadrant-examples">
							–û—Ç–ª–æ–∂–∏—Ç—å<br />
							‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤<br />
							‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –∫–æ–º–∞–Ω–¥—ã –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ<br />
							‚Ä¢ –û–±—Å—É–¥–∏—Ç—å —Å –∫–æ–º–∞–Ω–¥–æ–π<br />
							‚Ä¢ –î–æ—Ä–∞–±–æ—Ç–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
						</div>
					</div>
					<div class="drop-zone" data-quadrant="not-urgent-important"></div>
				</div>
				<div class="matrix-quadrant urgent-not-important">
					<div class="quadrant-header">
						<div class="quadrant-title">–°—Ä–æ—á–Ω–æ–µ</div>
						<div class="quadrant-subtitle">–ù–ï –í–ê–ñ–ù–û</div>
						<div class="quadrant-examples">
							–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å<br />
							‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç—å—é –≤ –±–ª–æ–≥<br />
							‚Ä¢ –ú–µ–ª–∫–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã<br />
							‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞—è–≤–∫–∏ —Å —Å–∞–π—Ç–∞<br />
							‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –º–µ–ª–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
						</div>
					</div>
					<div class="drop-zone" data-quadrant="urgent-not-important"></div>
				</div>
				<div class="matrix-quadrant not-urgent-not-important">
					<div class="quadrant-header">
						<div class="quadrant-title">–ù–µ —Å—Ä–æ—á–Ω–æ–µ</div>
						<div class="quadrant-subtitle">–ù–ï –í–ê–ñ–ù–û</div>
						<div class="quadrant-examples">
							–£–¥–∞–ª–∏—Ç—å<br />
							‚Ä¢ –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –±–µ–∑ —Ä–µ—à–µ–Ω–∏–π<br />
							‚Ä¢ –ß—Ä–µ–∑–º–µ—Ä–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤ -<br />
							‚Ä¢ –ò–∑—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤<br />
							‚Ä¢ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞ –ø–æ—Ä—Ç–∞–ª–µ
						</div>
					</div>
					<div class="drop-zone" data-quadrant="not-urgent-not-important"></div>
				</div>
			</div>
		</div>

		<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
		<div id="materialsModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h3>–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
				</div>
				<div class="form-group">
					<label for="linkTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏:</label>
					<input type="text" id="linkTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" />
				</div>
				<div class="form-group">
					<label for="linkUrl">URL —Å—Å—ã–ª–∫–∏:</label>
					<input type="url" id="linkUrl" placeholder="https://example.com" />
				</div>
				<div class="form-group">
					<label>–§–∞–π–ª—ã:</label>
					<div
						class="file-upload"
						onclick="document.getElementById('fileInput').click()"
					>
						<input type="file" id="fileInput" multiple />
						<p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏—Ö —Å—é–¥–∞</p>
					</div>
					<div id="attachedFiles" class="attached-files"></div>
				</div>
				<div class="modal-buttons">
					<button class="btn btn-secondary" onclick="closeMaterialsModal()">
						–û—Ç–º–µ–Ω–∞
					</button>
					<button class="btn btn-primary" onclick="saveMaterials()">
						–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
					</button>
				</div>
			</div>
		</div>

		<!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ User ID -->
		<div id="userIdDisplay" class="user-id-display" style="display: none">
			User ID: <span id="userIdText">loading...</span>
		</div>

		<div
			id="authPanel"
			style="position: fixed; top: 70px; right: 30px; z-index: 2000"
		>
			<!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google —É–¥–∞–ª–µ–Ω–∞ -->
			<button id="logoutBtn" class="btn btn-secondary" style="display: none">
				–í—ã–π—Ç–∏
			</button>
			<span
				id="userEmail"
				style="margin-left: 10px; font-size: 13px; color: #475569"
			></span>
		</div>

		<script type="module">
			import {
				collection,
				doc,
				setDoc,
				getDoc,
			} from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js'

			// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
			let draggedTask = null
			let draggedMaterial = null
			let draggedAttachedMaterial = null
			let currentMaterials = { links: [], files: [] }
			let attachedFilesData = new Map()
			let taskCounter = 0
			let autoSaveTimeout = null

			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
			let USER_ID = localStorage.getItem('eisenhower-user-id')
			if (!USER_ID) {
				USER_ID =
					'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
				localStorage.setItem('eisenhower-user-id', USER_ID)
			}

			const CLOUD_DOC_ID = `tasks_${USER_ID}`

			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º User ID
			document.addEventListener('DOMContentLoaded', function () {
				const userIdDisplay = document.getElementById('userIdDisplay')
				const userIdText = document.getElementById('userIdText')
				if (userIdDisplay && userIdText) {
					userIdText.textContent = USER_ID
					userIdDisplay.style.display = 'block'
				}
			})

			// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
			function scheduleAutoSave() {
				clearTimeout(autoSaveTimeout)
				autoSaveTimeout = setTimeout(() => {
					autoSaveToCloud()
				}, 1000) // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
			}

			// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ
			async function autoSaveToCloud() {
				if (!window.firebaseReady || !window.db) {
					console.log('Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ')
					return
				}

				try {
					const data = collectTasksData()
					if (!data || Object.keys(data).length === 0) {
						return
					}

					const docRef = doc(window.db, 'tasks', CLOUD_DOC_ID)
					await setDoc(docRef, {
						matrix: data,
						timestamp: Date.now(),
						userId: USER_ID,
						version: '2.0',
					})

					console.log('‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ —É—Å–ø–µ—à–Ω–æ')
				} catch (error) {
					console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error)
					// –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
					try {
						const data = collectTasksData()
						localStorage.setItem(
							'eisenhower-tasks-backup',
							JSON.stringify({
								matrix: data,
								timestamp: Date.now(),
							})
						)
					} catch (localError) {
						console.error('–û—à–∏–±–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–∞:', localError)
					}
				}
			}

			// –†—É—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ
			window.saveTasksToCloud = async function () {
				if (!window.firebaseReady || !window.db) {
					showSaveStatus('‚ùå –û–±–ª–∞–∫–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ', 'error')
					return
				}

				try {
					const data = collectTasksData()
					if (!data || Object.keys(data).length === 0) {
						showSaveStatus('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'warning')
						return
					}

					const docRef = doc(window.db, 'tasks', CLOUD_DOC_ID)
					await setDoc(docRef, {
						matrix: data,
						timestamp: Date.now(),
						userId: USER_ID,
						version: '2.0',
					})

					showSaveStatus('‚òÅÔ∏è –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞–∫–æ!', 'success')

					// –î—É–±–ª–∏—Ä—É–µ–º –≤ localStorage
					localStorage.setItem(
						'eisenhower-tasks-backup',
						JSON.stringify({
							matrix: data,
							timestamp: Date.now(),
						})
					)
				} catch (err) {
					console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', err)
					showSaveStatus(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`, 'error')

					// –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
					try {
						const data = collectTasksData()
						localStorage.setItem(
							'eisenhower-tasks-backup',
							JSON.stringify({
								matrix: data,
								timestamp: Date.now(),
							})
						)
						showSaveStatus('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤', 'warning')
					} catch (localError) {
						showSaveStatus('‚ùå –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error')
					}
				}
			}

			// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –æ–±–ª–∞–∫–∞
			window.loadTasksFromCloud = async function () {
				showSaveStatus('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...', 'warning')

				try {
					let data = null
					let source = ''

					// –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Firebase
					if (window.firebaseReady && window.db) {
						try {
							const docRef = doc(window.db, 'tasks', CLOUD_DOC_ID)
							const docSnap = await getDoc(docRef)

							if (docSnap.exists()) {
								const cloudData = docSnap.data()
								if (cloudData && cloudData.matrix) {
									data = cloudData
									source = 'cloud'
									console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞')
								}
							}
						} catch (firebaseError) {
							console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase:', firebaseError)
						}
					}

					// Fallback –∫ localStorage
					if (!data) {
						try {
							const savedData = localStorage.getItem('eisenhower-tasks-backup')
							if (savedData) {
								const parsedData = JSON.parse(savedData)
								if (parsedData && parsedData.matrix) {
									data = parsedData
									source = 'local'
									console.log('üíæ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage')
								}
							}
						} catch (localError) {
							console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', localError)
						}
					}

					if (!data || !data.matrix) {
						showSaveStatus('üìù –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', 'warning')
						return
					}

					// –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–∞—á–∏
					restoreTasksFromData(data.matrix)

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
					if (source === 'cloud') {
						const date = data.timestamp
							? new Date(data.timestamp).toLocaleString()
							: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
						showSaveStatus(`‚òÅÔ∏è –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –æ–±–ª–∞–∫–∞ (${date})`, 'success')
					} else {
						const date = data.timestamp
							? new Date(data.timestamp).toLocaleString()
							: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
						showSaveStatus(`üíæ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (${date})`, 'warning')
					}
				} catch (err) {
					console.error('–û–±—â–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err)
					showSaveStatus(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${err.message}`, 'error')
				}
			}

			// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–±–ª–∞–∫–∞
			window.checkCloudStatus = async function () {
				console.log('üîç === –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –û–ë–õ–ê–ö–ê ===')
				console.log('Firebase –≥–æ—Ç–æ–≤:', window.firebaseReady)
				console.log('User ID:', USER_ID)
				console.log('–î–æ–∫—É–º–µ–Ω—Ç ID:', CLOUD_DOC_ID)

				showSaveStatus('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–ª–∞–∫–æ...', 'warning')

				if (!window.firebaseReady || !window.db) {
					showSaveStatus('‚ùå Firebase –Ω–µ –≥–æ—Ç–æ–≤', 'error')
					return
				}

				try {
					const docRef = doc(window.db, 'tasks', CLOUD_DOC_ID)
					console.log('–ü—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É:', docRef.path)

					const docSnap = await getDoc(docRef)
					console.log('–î–æ–∫—É–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:', docSnap.exists())

					if (docSnap.exists()) {
						const data = docSnap.data()
						console.log('–î–∞–Ω–Ω—ã–µ:', data)

						let tasksCount = 0
						if (data.matrix) {
							Object.values(data.matrix).forEach(quadrant => {
								if (Array.isArray(quadrant)) {
									tasksCount += quadrant.length
								}
							})
						}

						const lastSaved = data.timestamp
							? new Date(data.timestamp).toLocaleString()
							: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
						showSaveStatus(
							`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${tasksCount} –∑–∞–¥–∞—á (${lastSaved})`,
							'success'
						)
					} else {
						showSaveStatus(
							'üìù –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
							'warning'
						)
					}

					// –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å
					await setDoc(
						docRef,
						{
							test: true,
							timestamp: Date.now(),
						},
						{ merge: true }
					)

					console.log('‚úÖ –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ —É—Å–ø–µ—à–µ–Ω')
					showSaveStatus('üéâ –û–±–ª–∞–∫–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success')
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error)
					showSaveStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error')
				}
			}

			// –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
			function collectTasksData() {
				const quadrants = [
					'urgent-important',
					'not-urgent-important',
					'urgent-not-important',
					'not-urgent-not-important',
				]
				const matrixData = {}

				quadrants.forEach(q => {
					const zone = document.querySelector(
						`.drop-zone[data-quadrant="${q}"]`
					)
					const tasks = []
					if (zone) {
						zone.querySelectorAll('.task-in-matrix').forEach(task => {
							const materials = []
							const materialsList = task.querySelector('.materials-list')
							if (materialsList) {
								materialsList
									.querySelectorAll('.material-item')
									.forEach(mat => {
										try {
											if (mat.dataset.materialType === 'link') {
												materials.push({
													type: 'link',
													name: mat.dataset.materialName || '–°—Å—ã–ª–∫–∞',
													url: mat.dataset.materialUrl || '#',
												})
											} else if (mat.dataset.materialType === 'file') {
												materials.push({
													type: 'file',
													name: mat.dataset.materialName || '–§–∞–π–ª',
												})
											}
										} catch (matError) {
											console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:', matError)
										}
									})
							}

							let taskText = ''
							try {
								const textNodes = []
								for (let node of task.childNodes) {
									if (
										node.nodeType === Node.TEXT_NODE &&
										node.textContent.trim()
									) {
										textNodes.push(node.textContent.trim())
									}
								}
								taskText = textNodes.join(' ').trim()

								if (!taskText) {
									taskText = task.textContent || ''
									taskText = taskText.replace(/√ó/g, '').replace(/‚¨á/g, '').trim()
								}
							} catch (textError) {
								console.warn('–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:', textError)
								taskText = '–ó–∞–¥–∞—á–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'
							}

							if (taskText) {
								tasks.push({
									text: taskText,
									materials,
								})
							}
						})
					}
					matrixData[q] = tasks
				})

				// –°–±–æ—Ä –∑–∞–¥–∞—á –∏–∑ —Å–∞–π–¥–±–∞—Ä–∞
				const sidebarTasks = []
				const tasksList = document.getElementById('tasksList')
				if (tasksList) {
					tasksList.querySelectorAll('.task-item').forEach(task => {
						const text = task.textContent.trim()
						if (text) {
							sidebarTasks.push({ text: text })
						}
					})
				}
				matrixData['sidebar'] = sidebarTasks

				return matrixData
			}

			// –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
			function showSaveStatus(message, type) {
				const existingStatus = document.querySelector('.save-status')
				if (existingStatus) {
					existingStatus.remove()
				}

				const statusDiv = document.createElement('div')
				statusDiv.className = 'save-status'
				statusDiv.textContent = message

				const colors = {
					success: '#10b981',
					warning: '#f59e0b',
					error: '#ef4444',
				}

				statusDiv.style.cssText = `
                position: fixed;
                top: 70px;
                right: 20px;
                background: ${colors[type] || colors.success};
                color: white;
                padding: 8px 16px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `

				document.body.appendChild(statusDiv)

				setTimeout(() => {
					if (statusDiv.parentNode) {
						statusDiv.style.animation = 'slideOut 0.3s ease'
						setTimeout(() => statusDiv.remove(), 300)
					}
				}, 3000)
			}

			// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á
			function restoreTasksFromData(matrixData) {
				const quadrants = [
					'urgent-important',
					'not-urgent-important',
					'urgent-not-important',
					'not-urgent-not-important',
				]

				quadrants.forEach(q => {
					const zone = document.querySelector(
						`.drop-zone[data-quadrant="${q}"]`
					)
					if (zone) {
						zone.innerHTML = ''
						const tasks = matrixData[q] || []
						tasks.forEach(taskObj => {
							if (taskObj.text) {
								const taskInMatrix = document.createElement('div')
								taskInMatrix.className = 'task-in-matrix'
								taskInMatrix.draggable = true
								taskInMatrix.innerHTML = `
                                ${taskObj.text}
                                <button class="delete-btn" onclick="removeTask(this)">√ó</button>
                            `

								if (taskObj.materials && taskObj.materials.length > 0) {
									const materialsDiv = document.createElement('div')
									materialsDiv.className = 'materials-list'
									taskObj.materials.forEach(mat => {
										if (mat.type === 'link' && mat.name && mat.url) {
											const linkDiv = createAttachedMaterial(
												'link',
												mat.name,
												mat.url,
												null,
												taskInMatrix
											)
											materialsDiv.appendChild(linkDiv)
										} else if (mat.type === 'file' && mat.name) {
											const fileDiv = createAttachedMaterial(
												'file',
												mat.name,
												null,
												null,
												taskInMatrix
											)
											materialsDiv.appendChild(fileDiv)
										}
									})
									if (materialsDiv.children.length > 0) {
										taskInMatrix.appendChild(materialsDiv)
										taskInMatrix.classList.add('materials-attached')
									}
								}

								addDirectDragEvents(taskInMatrix)
								zone.appendChild(taskInMatrix)
							}
						})
					}
				})

				// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ —Å–∞–π–¥–±–∞—Ä–µ
				const tasksList = document.getElementById('tasksList')
				if (tasksList) {
					tasksList.innerHTML = ''
					const sidebarTasks = matrixData['sidebar'] || []
					sidebarTasks.forEach(taskObj => {
						if (taskObj.text) {
							const taskItem = document.createElement('div')
							taskItem.className = 'task-item'
							taskItem.draggable = true
							taskItem.textContent = taskObj.text
							addDirectDragEvents(taskItem)
							tasksList.appendChild(taskItem)
						}
					})
				}
			}

			// –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
			function createAttachedMaterial(type, name, url, fileId, parentTask) {
				const materialDiv = document.createElement('div')
				materialDiv.className = 'material-item'
				materialDiv.draggable = true
				materialDiv.dataset.materialType = type
				materialDiv.dataset.materialName = name

				if (url) materialDiv.dataset.materialUrl = url
				if (fileId) materialDiv.dataset.fileId = fileId

				let content = ''
				if (type === 'link') {
					content = `
                    <div class="material-content">
                        <span class="material-icon">üîó</span>
                        <a href="${url}" target="_blank" class="material-link">${name}</a>
                    </div>
                    <div class="material-actions">
                        <button class="material-btn remove" onclick="removeAttachedMaterial(this)">√ó</button>
                    </div>
                `
				} else if (type === 'file') {
					content = `
                    <div class="material-content">
                        <span class="material-icon">üìÑ</span>
                        <span class="file-download">${name}</span>
                    </div>
                    <div class="material-actions">
                        ${
													fileId
														? `<button class="material-btn" onclick="downloadFile('${fileId}')">‚¨á</button>`
														: ''
												}
                        <button class="material-btn remove" onclick="removeAttachedMaterial(this)">√ó</button>
                    </div>
                `
				}

				materialDiv.innerHTML = content

				materialDiv.addEventListener('dragstart', function (e) {
					draggedAttachedMaterial = {
						element: this,
						type: this.dataset.materialType,
						name: this.dataset.materialName,
						url: this.dataset.materialUrl || null,
						fileId: this.dataset.fileId || null,
						parentTask: parentTask,
					}
					this.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'move'
				})

				materialDiv.addEventListener('dragend', function () {
					this.classList.remove('dragging')
					draggedAttachedMaterial = null
				})

				return materialDiv
			}

			// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
			window.toggleSidebar = function () {
				const sidebar = document.querySelector('.sidebar')
				const overlay = document.querySelector('.sidebar-overlay')
				const matrix = document.querySelector('.matrix')

				if (sidebar.classList.contains('show')) {
					sidebar.classList.remove('show')
					overlay.classList.remove('show')
					matrix.classList.remove('sidebar-open')
				} else {
					sidebar.classList.add('show')
					overlay.classList.add('show')
					matrix.classList.add('sidebar-open')
				}
			}

			// –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
			window.closeSidebar = function () {
				const sidebar = document.querySelector('.sidebar')
				const overlay = document.querySelector('.sidebar-overlay')
				const matrix = document.querySelector('.matrix')

				if (sidebar) sidebar.classList.remove('show')
				if (overlay) overlay.classList.remove('show')
				if (matrix) matrix.classList.remove('sidebar-open')
			}

			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
			document.addEventListener('DOMContentLoaded', function () {
				const mainTaskInput = document.getElementById('mainTaskInput')

				if (mainTaskInput) {
					mainTaskInput.addEventListener('keypress', function (e) {
						if (e.key === 'Enter' && this.value.trim()) {
							createTaskItem(this.value.trim())
							this.value = ''
						}
					})
				}

				const dropZones = document.querySelectorAll('.drop-zone')
				dropZones.forEach(zone => {
					zone.addEventListener('dragover', handleDragOver)
					zone.addEventListener('drop', handleDrop)
					zone.addEventListener('dragenter', handleDragEnter)
					zone.addEventListener('dragleave', handleDragLeave)
				})

				const fileInput = document.getElementById('fileInput')
				if (fileInput) {
					fileInput.addEventListener('change', handleFileSelect)
				}

				// –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
				setTimeout(() => {
					console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...')
					window.loadTasksFromCloud()
				}, 2000)

				// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
				const style = document.createElement('style')
				style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `
				document.head.appendChild(style)
			})

			// –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞–¥–∞—á–∏
			function createTaskItem(text) {
				const taskItem = document.createElement('div')
				taskItem.className = 'task-item'
				taskItem.draggable = true
				taskItem.textContent = text
				taskItem.id = 'task-' + ++taskCounter

				taskItem.addEventListener('dragstart', function (e) {
					draggedTask = this
					this.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'move'
					e.dataTransfer.setData('text/html', this.outerHTML)

					setTimeout(() => {
						window.closeSidebar()
					}, 100)
				})

				taskItem.addEventListener('dragend', function () {
					this.classList.remove('dragging')
					draggedTask = null
				})

				const tasksList = document.getElementById('tasksList')
				if (tasksList) {
					tasksList.appendChild(taskItem)
				}

				scheduleAutoSave()
			}

			// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π drag –¥–ª—è –∑–∞–¥–∞—á –≤ –º–∞—Ç—Ä–∏—Ü–µ
			function addMatrixTaskDragEvents(taskElement) {
				if (!taskElement.parentNode) {
					addDirectDragEvents(taskElement)
					return taskElement
				}

				const newTaskElement = taskElement.cloneNode(true)
				taskElement.parentNode.replaceChild(newTaskElement, taskElement)

				addDirectDragEvents(newTaskElement)
				return newTaskElement
			}

			// –ü—Ä—è–º–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π drag
			function addDirectDragEvents(taskElement) {
				taskElement.addEventListener('dragstart', function (e) {
					draggedTask = this
					this.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'move'
					e.dataTransfer.setData('text/html', this.outerHTML)

					setTimeout(() => {
						window.closeSidebar()
					}, 100)
				})

				taskElement.addEventListener('dragend', function () {
					this.classList.remove('dragging')
					draggedTask = null
				})

				taskElement.addEventListener('dragover', function (e) {
					if (draggedMaterial || draggedAttachedMaterial) {
						e.preventDefault()
						e.stopPropagation()
						this.classList.add('drag-over-task')
					}
				})

				taskElement.addEventListener('dragleave', function (e) {
					if (
						(draggedMaterial || draggedAttachedMaterial) &&
						!this.contains(e.relatedTarget)
					) {
						this.classList.remove('drag-over-task')
					}
				})

				taskElement.addEventListener('drop', function (e) {
					if (draggedMaterial) {
						e.preventDefault()
						e.stopPropagation()
						this.classList.remove('drag-over-task')
						attachMaterialToTask(this, draggedMaterial)
					} else if (draggedAttachedMaterial) {
						e.preventDefault()
						e.stopPropagation()
						this.classList.remove('drag-over-task')

						if (draggedAttachedMaterial.parentTask !== this) {
							reattachMaterialToTask(this, draggedAttachedMaterial)
						}
					}
				})
			}

			function handleDragEnter(e) {
				e.preventDefault()
			}

			function handleDragLeave(e) {
				// –õ–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∑–æ–Ω—ã
			}

			function handleDragOver(e) {
				e.preventDefault()
			}

			function handleDrop(e) {
				e.preventDefault()

				if (draggedTask) {
					if (draggedTask.classList.contains('task-item')) {
						const taskInMatrix = document.createElement('div')
						taskInMatrix.className = 'task-in-matrix'
						taskInMatrix.draggable = true
						taskInMatrix.innerHTML = `
                        ${draggedTask.textContent}
                        <button class="delete-btn" onclick="removeTask(this)">√ó</button>
                    `

						const finalTask = addMatrixTaskDragEvents(taskInMatrix)
						this.appendChild(finalTask)
						draggedTask.remove()

						scheduleAutoSave()
					} else if (draggedTask.classList.contains('task-in-matrix')) {
						this.appendChild(draggedTask)
						addDirectDragEvents(draggedTask)

						scheduleAutoSave()
					}
				} else if (draggedAttachedMaterial) {
					detachMaterialToPreview(draggedAttachedMaterial)
					scheduleAutoSave()
				}
			}

			// –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
			window.removeTask = function (button) {
				if (button && button.parentElement) {
					button.parentElement.remove()
					scheduleAutoSave()
				}
			}

			// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			window.openMaterialsModal = function () {
				const modal = document.getElementById('materialsModal')
				if (modal) {
					modal.style.display = 'block'
				}
			}

			// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			window.closeMaterialsModal = function () {
				const modal = document.getElementById('materialsModal')
				if (modal) {
					modal.style.display = 'none'
				}

				const linkTitle = document.getElementById('linkTitle')
				const linkUrl = document.getElementById('linkUrl')
				const fileInput = document.getElementById('fileInput')
				const attachedFiles = document.getElementById('attachedFiles')

				if (linkTitle) linkTitle.value = ''
				if (linkUrl) linkUrl.value = ''
				if (fileInput) fileInput.value = ''
				if (attachedFiles) attachedFiles.innerHTML = ''
			}

			// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			window.saveMaterials = function () {
				const titleEl = document.getElementById('linkTitle')
				const urlEl = document.getElementById('linkUrl')
				const fileInput = document.getElementById('fileInput')

				const title = titleEl ? titleEl.value.trim() : ''
				const url = urlEl ? urlEl.value.trim() : ''

				if (title && url) {
					currentMaterials.links.push({ title, url })
				}

				if (fileInput && fileInput.files.length > 0) {
					Array.from(fileInput.files).forEach(file => {
						currentMaterials.files.push({ name: file.name, file: file })
					})
				}

				window.closeMaterialsModal()
				updateMaterialsPreview()

				if (
					currentMaterials.links.length > 0 ||
					currentMaterials.files.length > 0
				) {
					const btn = document.querySelector('.add-materials-btn')
					if (btn) {
						btn.style.background = '#ff9800'
						btn.textContent = '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—é'
					}
				}
			}

			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			function updateMaterialsPreview() {
				const preview = document.getElementById('materialsPreview')
				if (!preview) return

				const hasContent =
					currentMaterials.links.length > 0 || currentMaterials.files.length > 0

				if (hasContent) {
					preview.classList.add('has-materials')
					let html = '<h4>üìé –ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</h4>'
					html +=
						'<div class="help-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞–∂–¥—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ –Ω—É–∂–Ω—É—é –∑–∞–¥–∞—á—É</div>'

					currentMaterials.links.forEach((link, index) => {
						html += `
                        <div class="preview-item" draggable="true" data-type="link" data-index="${index}">
                            <div class="preview-content">
                                <span class="preview-icon">üîó</span>
                                <div class="preview-text">
                                    <a href="${link.url}" target="_blank" class="preview-link">${link.title}</a>
                                </div>
                            </div>
                            <button class="preview-remove" onclick="removeMaterialLink(${index})">√ó</button>
                        </div>
                    `
					})

					currentMaterials.files.forEach((file, index) => {
						html += `
                        <div class="preview-item" draggable="true" data-type="file" data-index="${index}">
                            <div class="preview-content">
                                <span class="preview-icon">üìÑ</span>
                                <div class="preview-text">${file.name}</div>
                            </div>
                            <button class="preview-remove" onclick="removeMaterialFile(${index})">√ó</button>
                        </div>
                    `
					})

					preview.innerHTML = html

					const materialItems = preview.querySelectorAll('.preview-item')
					materialItems.forEach(item => {
						addMaterialDragEvents(item)
					})
				} else {
					preview.classList.remove('has-materials')
					preview.innerHTML = ''
				}
			}

			// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π drag –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			function addMaterialDragEvents(materialElement) {
				materialElement.addEventListener('dragstart', function (e) {
					draggedMaterial = this
					this.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'copy'
					e.dataTransfer.setData('text/html', this.outerHTML)

					setTimeout(() => {
						window.closeSidebar()
					}, 100)
				})

				materialElement.addEventListener('dragend', function () {
					this.classList.remove('dragging')
					draggedMaterial = null
				})
			}

			// –£–¥–∞–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –∏–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			window.removeMaterialLink = function (index) {
				currentMaterials.links.splice(index, 1)
				updateMaterialsPreview()

				if (
					currentMaterials.links.length === 0 &&
					currentMaterials.files.length === 0
				) {
					const btn = document.querySelector('.add-materials-btn')
					if (btn) {
						btn.style.background = ''
						btn.textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã'
					}
				}
			}

			// –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			window.removeMaterialFile = function (index) {
				currentMaterials.files.splice(index, 1)
				updateMaterialsPreview()

				if (
					currentMaterials.links.length === 0 &&
					currentMaterials.files.length === 0
				) {
					const btn = document.querySelector('.add-materials-btn')
					if (btn) {
						btn.style.background = ''
						btn.textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã'
					}
				}
			}

			// –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∫ –∑–∞–¥–∞—á–µ
			function attachMaterialToTask(task, materialElement) {
				const type = materialElement.dataset.type
				const index = parseInt(materialElement.dataset.index)

				let materialsDiv = task.querySelector('.materials-list')
				if (!materialsDiv) {
					materialsDiv = document.createElement('div')
					materialsDiv.className = 'materials-list'
					task.appendChild(materialsDiv)
					task.classList.add('materials-attached')
				}

				if (type === 'link') {
					const link = currentMaterials.links[index]
					if (link && link.title && link.url) {
						const linkDiv = createAttachedMaterial(
							'link',
							link.title,
							link.url,
							null,
							task
						)
						materialsDiv.appendChild(linkDiv)
						currentMaterials.links.splice(index, 1)
					}
				} else if (type === 'file') {
					const file = currentMaterials.files[index]
					if (file) {
						const fileId =
							'file-' +
							Date.now() +
							'-' +
							Math.random().toString(36).substr(2, 9)
						attachedFilesData.set(fileId, file.file)

						const fileDiv = createAttachedMaterial(
							'file',
							file.name,
							null,
							fileId,
							task
						)
						materialsDiv.appendChild(fileDiv)
						currentMaterials.files.splice(index, 1)
					}
				}

				updateMaterialsPreview()

				if (
					currentMaterials.links.length === 0 &&
					currentMaterials.files.length === 0
				) {
					const btn = document.querySelector('.add-materials-btn')
					if (btn) {
						btn.style.background = ''
						btn.textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã'
					}
				}

				scheduleAutoSave()
			}

			// –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∫ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ
			function reattachMaterialToTask(newTask, attachedMaterialData) {
				if (
					attachedMaterialData.element &&
					attachedMaterialData.element.parentNode
				) {
					attachedMaterialData.element.remove()
				}

				if (attachedMaterialData.parentTask) {
					const oldMaterialsList =
						attachedMaterialData.parentTask.querySelector('.materials-list')
					if (oldMaterialsList && oldMaterialsList.children.length === 0) {
						attachedMaterialData.parentTask.classList.remove(
							'materials-attached'
						)
						oldMaterialsList.remove()
					}
				}

				let materialsDiv = newTask.querySelector('.materials-list')
				if (!materialsDiv) {
					materialsDiv = document.createElement('div')
					materialsDiv.className = 'materials-list'

					newTask.appendChild(materialsDiv)
					newTask.classList.add('materials-attached')
				}

				const newMaterialDiv = createAttachedMaterial(
					attachedMaterialData.type,
					attachedMaterialData.name,
					attachedMaterialData.url,
					attachedMaterialData.fileId,
					newTask
				)

				materialsDiv.appendChild(newMaterialDiv)
				scheduleAutoSave()
			}

			// –û—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
			function detachMaterialToPreview(attachedMaterialData) {
				if (
					attachedMaterialData.element &&
					attachedMaterialData.element.parentNode
				) {
					const preview = document.getElementById('materialsPreview')
					attachedMaterialData.element.remove()
					if (preview) {
						preview.appendChild(attachedMaterialData.element)
					}
				}

				if (attachedMaterialData.parentTask) {
					const oldMaterialsList =
						attachedMaterialData.parentTask.querySelector('.materials-list')
					if (oldMaterialsList && oldMaterialsList.children.length === 0) {
						attachedMaterialData.parentTask.classList.remove(
							'materials-attached'
						)
						oldMaterialsList.remove()
					}
				}

				attachedMaterialData.element = null
			}

			// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
			window.downloadFile = function (fileId) {
				const file = attachedFilesData.get(fileId)
				if (file) {
					const url = URL.createObjectURL(file)
					const a = document.createElement('a')
					a.href = url
					a.download = file.name
					document.body.appendChild(a)
					a.click()
					setTimeout(() => {
						document.body.removeChild(a)
						URL.revokeObjectURL(url)
					}, 100)
				} else {
					console.error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω:', fileId)
					alert('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω')
				}
			}

			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
			function handleFileSelect(event) {
				const files = event.target.files
				if (files.length > 0) {
					Array.from(files).forEach(file => {
						currentMaterials.files.push({ name: file.name, file: file })
					})
					const btn = document.querySelector('.add-materials-btn')
					if (btn) {
						btn.style.background = '#ff9800'
						btn.textContent = '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—é'
					}
					updateMaterialsPreview()
				}
			}

			// –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
			document.addEventListener('dragstart', function (e) {
				if (
					e.target.classList.contains('task-item') ||
					e.target.classList.contains('task-in-matrix')
				) {
					draggedTask = e.target
					draggedTask.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'move'
					e.dataTransfer.setData('text/html', draggedTask.outerHTML)

					setTimeout(() => {
						window.closeSidebar()
					}, 100)
				}
			})

			document.addEventListener('dragend', function (e) {
				if (draggedTask) {
					draggedTask.classList.remove('dragging')
					draggedTask = null
				}
				if (draggedMaterial) {
					draggedMaterial.classList.remove('dragging')
					draggedMaterial = null
				}
				if (draggedAttachedMaterial) {
					draggedAttachedMaterial.classList.remove('dragging')
					draggedAttachedMaterial = null
				}
			})

			// –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			document.addEventListener('dragstart', function (e) {
				if (e.target.classList.contains('material-item')) {
					draggedMaterial = e.target
					draggedMaterial.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'copy'
					e.dataTransfer.setData('text/html', draggedMaterial.outerHTML)
				}
			})

			document.addEventListener('dragend', function (e) {
				if (draggedMaterial) {
					draggedMaterial.classList.remove('dragging')
					draggedMaterial = null
				}
				if (draggedAttachedMaterial) {
					draggedAttachedMaterial.classList.remove('dragging')
					draggedAttachedMaterial = null
				}
			})

			// –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
			document.addEventListener('dragstart', function (e) {
				if (e.target.classList.contains('material-item')) {
					draggedAttachedMaterial = e.target
					draggedAttachedMaterial.classList.add('dragging')
					e.dataTransfer.effectAllowed = 'move'
					e.dataTransfer.setData('text/html', draggedAttachedMaterial.outerHTML)
				}
			})

			document.addEventListener('dragend', function (e) {
				if (draggedAttachedMaterial) {
					draggedAttachedMaterial.classList.remove('dragging')
					draggedAttachedMaterial = null
				}
			})
		</script>
	</body>
</html>
